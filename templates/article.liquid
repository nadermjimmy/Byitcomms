{% comment %}
  Article Template - Individual Blog Post
{% endcomment %}

<article class="article-page" data-section-id="article-{{ article.id }}" data-section-type="article">
  <div class="page-width">
    
    {% comment %} Article Header {% endcomment %}
    <header class="article-header">
      <nav class="breadcrumb" role="navigation" aria-label="breadcrumbs">
        <a href="{{ routes.root_url }}" class="breadcrumb__link">{{ 'general.breadcrumbs.home' | t }}</a>
        <span class="breadcrumb__separator">
          <svg width="6" height="10" viewBox="0 0 6 10" fill="none">
            <path d="M1 1L5 5L1 9" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </span>
        <a href="{{ blog.url }}" class="breadcrumb__link">{{ blog.title }}</a>
        <span class="breadcrumb__separator">
          <svg width="6" height="10" viewBox="0 0 6 10" fill="none">
            <path d="M1 1L5 5L1 9" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </span>
        <span class="breadcrumb__text">{{ article.title | truncate: 50 }}</span>
      </nav>
      
      {% if article.tags.size > 0 %}
        <div class="article-header__tags">
          {% for tag in article.tags limit: 3 %}
            <a href="{{ blog.url }}/tagged/{{ tag | handle }}" class="article-header__tag">
              {{ tag }}
            </a>
          {% endfor %}
        </div>
      {% endif %}
      
      <h1 class="article-header__title">{{ article.title }}</h1>
      
      <div class="article-header__meta">
        <div class="article-meta">
          <div class="article-meta__author">
            <div class="article-meta__author-avatar">
              <svg width="32" height="32" viewBox="0 0 32 32" fill="none">
                <circle cx="16" cy="16" r="15" stroke="currentColor" stroke-width="1"/>
                <circle cx="16" cy="12" r="4" stroke="currentColor" stroke-width="1"/>
                <path d="M8 28v-2a6 6 0 0 1 6-6h4a6 6 0 0 1 6 6v2" stroke="currentColor" stroke-width="1"/>
              </svg>
            </div>
            <div class="article-meta__author-info">
              <span class="article-meta__author-name">{{ article.author }}</span>
              <span class="article-meta__author-title">{{ 'blog.author_title' | t }}</span>
            </div>
          </div>
          
          <div class="article-meta__details">
            <time class="article-meta__date" datetime="{{ article.published_at | date: '%Y-%m-%d' }}">
              {{ article.published_at | date: format: 'month_day_year' }}
            </time>
            <span class="article-meta__reading-time">
              {{ article.content | strip_html | number_of_words | divided_by: 200 | at_least: 1 }} {{ 'blog.min_read' | t }}
            </span>
          </div>
        </div>
      </div>

      {% if article.image %}
        <div class="article-header__image">
          <img
            src="{{ article.image | image_url: width: 1200 }}"
            alt="{{ article.image.alt | escape }}"
            srcset="
              {{ article.image | image_url: width: 600 }} 600w,
              {{ article.image | image_url: width: 900 }} 900w,
              {{ article.image | image_url: width: 1200 }} 1200w,
              {{ article.image | image_url: width: 1500 }} 1500w
            "
            sizes="(min-width: 1200px) 1200px, 100vw"
            loading="eager"
            class="article-header__img"
          >
        </div>
      {% endif %}
    </header>

    <div class="article-content">
      
      {% comment %} Article Body {% endcomment %}
      <div class="article-main">
        <div class="article-body rte">
          {{ article.content }}
        </div>

        {% comment %} Article Actions {% endcomment %}
        <div class="article-actions">
          <div class="article-actions__share">
            <span class="article-actions__share-label">{{ 'blog.share_article' | t }}:</span>
            <div class="article-actions__share-buttons">
              <a href="https://www.facebook.com/sharer/sharer.php?u={{ shop.url }}{{ article.url }}" 
                 target="_blank" 
                 rel="noopener noreferrer"
                 class="article-actions__share-button"
                 aria-label="{{ 'blog.share_on_facebook' | t }}">
                <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                  <path d="M18.896 0H1.104C.494 0 0 .494 0 1.104v17.793C0 19.506.494 20 1.104 20h9.58v-7.745H8.076V9.237h2.606V7.01c0-2.583 1.578-3.99 3.883-3.99 1.104 0 2.052.082 2.329.119v2.7l-1.598.001c-1.254 0-1.496.597-1.496 1.47v1.928h2.989l-.39 3.018h-2.6V20h5.098c.608 0 1.102-.494 1.102-1.104V1.104C20 .494 19.506 0 18.896 0z"/>
                </svg>
              </a>
              
              <a href="https://twitter.com/intent/tweet?url={{ shop.url }}{{ article.url }}&text={{ article.title | escape }}" 
                 target="_blank" 
                 rel="noopener noreferrer"
                 class="article-actions__share-button"
                 aria-label="{{ 'blog.share_on_twitter' | t }}">
                <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                  <path d="M6.29 18.251c7.547 0 11.675-6.253 11.675-11.675 0-.178 0-.355-.012-.53A8.348 8.348 0 0020 3.92a8.19 8.19 0 01-2.357.646 4.118 4.118 0 001.804-2.27 8.224 8.224 0 01-2.605.996 4.107 4.107 0 00-6.993 3.743 11.65 11.65 0 01-8.457-4.287 4.106 4.106 0 001.27 5.477A4.073 4.073 0 01.8 7.713v.052a4.105 4.105 0 003.292 4.022 4.095 4.095 0 01-1.853.07 4.108 4.108 0 003.834 2.85A8.233 8.233 0 010 16.407a11.616 11.616 0 006.29 1.84"/>
                </svg>
              </a>
              
              <a href="https://www.linkedin.com/sharing/share-offsite/?url={{ shop.url }}{{ article.url }}" 
                 target="_blank" 
                 rel="noopener noreferrer"
                 class="article-actions__share-button"
                 aria-label="{{ 'blog.share_on_linkedin' | t }}">
                <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                  <path d="M18.335 18.339H15.67v-4.177c0-.996-.02-2.278-1.39-2.278-1.389 0-1.601 1.084-1.601 2.205v4.25h-2.666V9.75h2.56v1.17h.035c.358-.674 1.228-1.387 2.528-1.387 2.7 0 3.2 1.778 3.2 4.091v4.715zM4.943 8.57c-.857 0-1.549-.694-1.549-1.548a1.548 1.548 0 111.549 1.548zm1.338 9.769H3.605V9.75h2.676v8.589zM19.67 0H.329C.146 0 0 .154 0 .329v19.341C0 19.846.154 20 .329 20h19.341c.176 0 .329-.154.329-.329V.329C20 .154 19.846 0 19.67 0z"/>
                </svg>
              </a>
              
              <button type="button" class="article-actions__share-button" data-copy-url aria-label="{{ 'blog.copy_link' | t }}">
                <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                  <path d="M10 13a3 3 0 0 0 3-3V7a3 3 0 0 0-3-3 3 3 0 0 0-3 3v3a3 3 0 0 0 3 3zM10 13a3 3 0 0 1-3 3H4a3 3 0 0 1-3-3V7a3 3 0 0 1 3-3h3a3 3 0 0 1 3 3m0 6a3 3 0 0 0 3-3V7a3 3 0 0 0-3-3" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
              </button>
            </div>
          </div>
        </div>

        {% comment %} Article Navigation {% endcomment %}
        {% if article.moderated? and article.comments_enabled? %}
          <div class="article-comments">
            <h3 class="article-comments__title">{{ 'blog.comments_title' | t }} ({{ article.comments_count }})</h3>
            
            {% paginate article.comments by 5 %}
              {% if article.comments.size > 0 %}
                <div class="article-comments__list">
                  {% for comment in article.comments %}
                    <div class="article-comment" id="comment-{{ comment.id }}">
                      <div class="article-comment__avatar">
                        <svg width="40" height="40" viewBox="0 0 40 40" fill="none">
                          <circle cx="20" cy="20" r="19" stroke="currentColor" stroke-width="1"/>
                          <circle cx="20" cy="15" r="5" stroke="currentColor" stroke-width="1"/>
                          <path d="M10 35v-3a8 8 0 0 1 8-8h4a8 8 0 0 1 8 8v3" stroke="currentColor" stroke-width="1"/>
                        </svg>
                      </div>
                      <div class="article-comment__content">
                        <div class="article-comment__header">
                          <h4 class="article-comment__author">{{ comment.author }}</h4>
                          <time class="article-comment__date" datetime="{{ comment.created_at | date: '%Y-%m-%d' }}">
                            {{ comment.created_at | date: format: 'abbreviated_date' }}
                          </time>
                        </div>
                        <div class="article-comment__body">
                          {{ comment.content }}
                        </div>
                      </div>
                    </div>
                  {% endfor %}
                </div>

                {% if paginate.pages > 1 %}
                  <nav class="pagination pagination--comments">
                    {% if paginate.previous %}
                      <a href="{{ paginate.previous.url }}" class="pagination__item pagination__item--prev">
                        {{ 'general.pagination.previous' | t }}
                      </a>
                    {% endif %}
                    
                    {% for part in paginate.parts %}
                      {% if part.is_link %}
                        <a href="{{ part.url }}" class="pagination__item">{{ part.title }}</a>
                      {% else %}
                        <span class="pagination__item{% if part.title == paginate.current_page %} pagination__item--current{% endif %}">{{ part.title }}</span>
                      {% endif %}
                    {% endfor %}
                    
                    {% if paginate.next %}
                      <a href="{{ paginate.next.url }}" class="pagination__item pagination__item--next">
                        {{ 'general.pagination.next' | t }}
                      </a>
                    {% endif %}
                  </nav>
                {% endif %}
              {% endif %}
            {% endpaginate %}

            {% comment %} Comment Form {% endcomment %}
            {% form 'new_comment', article, class: 'comment-form' %}
              <h4 class="comment-form__title">{{ 'blog.leave_comment' | t }}</h4>
              
              {% if form.posted_successfully? %}
                <div class="comment-form__success">
                  {% if blog.moderated? %}
                    {{ 'blog.comment_moderation' | t }}
                  {% else %}
                    {{ 'blog.comment_success' | t }}
                  {% endif %}
                </div>
              {% endif %}

              {% if form.errors %}
                <div class="comment-form__errors">
                  {{ form.errors | default_errors }}
                </div>
              {% endif %}

              <div class="comment-form__fields">
                <div class="comment-form__field">
                  <label for="CommentAuthor" class="comment-form__label">{{ 'blog.name' | t }} *</label>
                  <input type="text" id="CommentAuthor" name="comment[author]" class="comment-form__input" required>
                </div>
                
                <div class="comment-form__field">
                  <label for="CommentEmail" class="comment-form__label">{{ 'blog.email' | t }} *</label>
                  <input type="email" id="CommentEmail" name="comment[email]" class="comment-form__input" required>
                </div>
                
                <div class="comment-form__field comment-form__field--full">
                  <label for="CommentBody" class="comment-form__label">{{ 'blog.comment' | t }} *</label>
                  <textarea id="CommentBody" name="comment[body]" class="comment-form__textarea" rows="4" required></textarea>
                </div>
              </div>

              <button type="submit" class="btn btn--primary comment-form__submit">
                {{ 'blog.post_comment' | t }}
              </button>
            {% endform %}
          </div>
        {% endif %}
      </div>

      {% comment %} Article Sidebar {% endcomment %}
      <aside class="article-sidebar">
        
        {% comment %} Related Articles {% endcomment %}
        {% assign related_articles = blog.articles | where: 'tags', article.tags.first | where: 'id', '!=', article.id | limit: 3 %}
        {% if related_articles.size > 0 %}
          <div class="article-sidebar__related">
            <h3 class="article-sidebar__title">{{ 'blog.related_articles' | t }}</h3>
            <div class="related-articles">
              {% for related_article in related_articles %}
                <article class="related-article">
                  {% if related_article.image %}
                    <div class="related-article__image">
                      <a href="{{ related_article.url }}">
                        <img
                          src="{{ related_article.image | image_url: width: 150 }}"
                          alt="{{ related_article.image.alt | escape }}"
                          loading="lazy"
                          class="related-article__img"
                        >
                      </a>
                    </div>
                  {% endif %}
                  <div class="related-article__content">
                    <h4 class="related-article__title">
                      <a href="{{ related_article.url }}">{{ related_article.title }}</a>
                    </h4>
                    <time class="related-article__date" datetime="{{ related_article.published_at | date: '%Y-%m-%d' }}">
                      {{ related_article.published_at | date: format: 'abbreviated_date' }}
                    </time>
                  </div>
                </article>
              {% endfor %}
            </div>
          </div>
        {% endif %}

        {% comment %} Article Tags {% endcomment %}
        {% if article.tags.size > 0 %}
          <div class="article-sidebar__tags">
            <h3 class="article-sidebar__title">{{ 'blog.tags' | t }}</h3>
            <div class="article-tags">
              {% for tag in article.tags %}
                <a href="{{ blog.url }}/tagged/{{ tag | handle }}" class="article-tag">
                  {{ tag }}
                </a>
              {% endfor %}
            </div>
          </div>
        {% endif %}

      </aside>
    </div>

    {% comment %} Article Navigation {% endcomment %}
    <nav class="article-navigation">
      {% if blog.previous_article %}
        <a href="{{ blog.previous_article.url }}" class="article-navigation__prev">
          <div class="article-navigation__direction">{{ 'blog.previous_article' | t }}</div>
          <div class="article-navigation__title">{{ blog.previous_article.title }}</div>
        </a>
      {% endif %}
      
      <a href="{{ blog.url }}" class="article-navigation__blog">
        {{ 'blog.back_to_blog' | t: blog_title: blog.title }}
      </a>
      
      {% if blog.next_article %}
        <a href="{{ blog.next_article.url }}" class="article-navigation__next">
          <div class="article-navigation__direction">{{ 'blog.next_article' | t }}</div>
          <div class="article-navigation__title">{{ blog.next_article.title }}</div>
        </a>
      {% endif %}
    </nav>

  </div>
</article>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    // Copy URL functionality
    const copyButton = document.querySelector('[data-copy-url]');
    if (copyButton) {
      copyButton.addEventListener('click', function() {
        navigator.clipboard.writeText(window.location.href).then(() => {
          // Show success feedback
          const originalText = this.innerHTML;
          this.innerHTML = '<svg width="20" height="20" viewBox="0 0 20 20" fill="none"><path d="M16.5 6L7.5 15l-4-4" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>';
          this.style.color = '#28a745';
          
          setTimeout(() => {
            this.innerHTML = originalText;
            this.style.color = '';
          }, 2000);
        });
      });
    }

    // Smooth scroll to comments
    const commentLinks = document.querySelectorAll('a[href^="#comment-"]');
    commentLinks.forEach(link => {
      link.addEventListener('click', function(e) {
        e.preventDefault();
        const target = document.querySelector(this.getAttribute('href'));
        if (target) {
          target.scrollIntoView({ behavior: 'smooth' });
          target.classList.add('highlight');
          setTimeout(() => target.classList.remove('highlight'), 2000);
        }
      });
    });
  });
</script>